{% extends 'base.html' %}

{% block title %}Mutual Funds Visualizations - FinDash{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Mutual Funds Visualizations</h1>
        <div>
            <a href="{{ url_for('mf_analysis.index') }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>Back to Overview
            </a>
        </div>
    </div>

    <!-- Visualization Tabs -->
    <ul class="nav nav-tabs mb-4" id="visualizationTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                <i class="fas fa-chart-pie me-2"></i>Overview
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="returns-tab" data-bs-toggle="tab" data-bs-target="#returns" type="button" role="tab" aria-controls="returns" aria-selected="false">
                <i class="fas fa-chart-line me-2"></i>Returns Analysis
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="aum-tab" data-bs-toggle="tab" data-bs-target="#aum" type="button" role="tab" aria-controls="aum" aria-selected="false">
                <i class="fas fa-money-bill-wave me-2"></i>AUM Analysis
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="allocation-tab" data-bs-toggle="tab" data-bs-target="#allocation" type="button" role="tab" aria-controls="allocation" aria-selected="false">
                <i class="fas fa-balance-scale me-2"></i>Allocation Analysis
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab" aria-controls="data" aria-selected="false">
                <i class="fas fa-table me-2"></i>Data Table
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="visualizationTabsContent">
        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">Fund Type Distribution</h5>
                        </div>
                        <div class="card-body">
                            {% if fund_type_chart %}
                            <img src="data:image/png;base64,{{ fund_type_chart }}" class="img-fluid" alt="Fund Type Distribution">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">Correlation Between Metrics</h5>
                        </div>
                        <div class="card-body">
                            {% if returns_correlation_chart %}
                            <img src="data:image/png;base64,{{ returns_correlation_chart }}" class="img-fluid" alt="Correlation Between Metrics">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Returns Analysis Tab -->
        <div class="tab-pane fade" id="returns" role="tabpanel" aria-labelledby="returns-tab">
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">1 Year vs 3 Year Returns</h5>
                        </div>
                        <div class="card-body">
                            {% if one_vs_three_year_chart %}
                            <img src="data:image/png;base64,{{ one_vs_three_year_chart }}" class="img-fluid" alt="1 Year vs 3 Year Returns">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">1 Year vs 5 Year Returns</h5>
                        </div>
                        <div class="card-body">
                            {% if one_vs_five_year_chart %}
                            <img src="data:image/png;base64,{{ one_vs_five_year_chart }}" class="img-fluid" alt="1 Year vs 5 Year Returns">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AUM Analysis Tab -->
        <div class="tab-pane fade" id="aum" role="tabpanel" aria-labelledby="aum-tab">
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">AUM vs 1 Year Return</h5>
                        </div>
                        <div class="card-body">
                            {% if aum_vs_one_year_chart %}
                            <img src="data:image/png;base64,{{ aum_vs_one_year_chart }}" class="img-fluid" alt="AUM vs 1 Year Return">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">AUM vs 3 Year Return</h5>
                        </div>
                        <div class="card-body">
                            {% if aum_vs_three_year_chart %}
                            <img src="data:image/png;base64,{{ aum_vs_three_year_chart }}" class="img-fluid" alt="AUM vs 3 Year Return">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">AUM vs 5 Year Return</h5>
                        </div>
                        <div class="card-body">
                            {% if aum_vs_five_year_chart %}
                            <img src="data:image/png;base64,{{ aum_vs_five_year_chart }}" class="img-fluid" alt="AUM vs 5 Year Return">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Allocation Analysis Tab -->
        <div class="tab-pane fade" id="allocation" role="tabpanel" aria-labelledby="allocation-tab">
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">Debt Percentage vs Returns</h5>
                        </div>
                        <div class="card-body">
                            {% if debt_percentage_charts %}
                            <img src="data:image/png;base64,{{ debt_percentage_charts }}" class="img-fluid" alt="Debt Percentage vs Returns">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">Equity Percentage vs Returns</h5>
                        </div>
                        <div class="card-body">
                            {% if equity_percentage_charts %}
                            <img src="data:image/png;base64,{{ equity_percentage_charts }}" class="img-fluid" alt="Equity Percentage vs Returns">
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Chart data not available
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table Tab -->
        <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Mutual Funds Data</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Fund Name</th>
                                    <th>Type</th>
                                    <th>Rating</th>
                                    <th>AUM (Cr.)</th>
                                    <th>NAV</th>
                                    <th>Expense Ratio</th>
                                    <th>1 Year Return</th>
                                    <th>3 Year Return</th>
                                    <th>5 Year Return</th>
                                    <th>Risk</th>
                                    <th>Equity %</th>
                                    <th>Debt %</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if table_data %}
                                    {% for row in table_data %}
                                    <tr>
                                        <td>{{ row['Fund Name'] }}</td>
                                        <td>{{ row['Type'] }}</td>
                                        <td>{{ row['Rating'] }}</td>
                                        <td>{{ row['AUM (Cr.)'] }}</td>
                                        <td>{{ row['NAV'] }}</td>
                                        <td>{{ row['Expense Ratio'] }}</td>
                                        <td>{{ row['1 Year Return'] }}%</td>
                                        <td>{{ row['3 Year Return'] }}%</td>
                                        <td>{{ row['5 Year Return'] }}%</td>
                                        <td>{{ row['Risk'] }}</td>
                                        <td>{{ row['Equity %'] }}%</td>
                                        <td>{{ row['Debt %'] }}%</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="12" class="text-center">No data available</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Insights -->
    <div class="card shadow-sm mt-4">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">Key Insights</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="fw-bold"><i class="fas fa-lightbulb text-warning me-2"></i>Fund Type Distribution</h6>
                    <p>Equity funds dominate the mutual fund market in India, followed by hybrid funds. This reflects investors' preference for growth-oriented investments despite higher volatility.</p>
                    
                    <h6 class="fw-bold mt-3"><i class="fas fa-lightbulb text-warning me-2"></i>Returns Correlation</h6>
                    <p>There is a strong positive correlation between 3-year and 5-year returns, suggesting that funds that perform well over a 3-year period tend to maintain their performance over longer horizons.</p>
                </div>
                <div class="col-md-6">
                    <h6 class="fw-bold"><i class="fas fa-lightbulb text-warning me-2"></i>AUM Impact</h6>
                    <p>Larger funds (higher AUM) show more consistent returns over longer periods, but fund size doesn't necessarily correlate with higher returns. Some smaller funds outperform their larger counterparts.</p>
                    
                    <h6 class="fw-bold mt-3"><i class="fas fa-lightbulb text-warning me-2"></i>Equity-Debt Allocation</h6>
                    <p>Funds with higher equity allocation tend to show higher returns over 5-year periods, but also exhibit greater volatility in 1-year returns. This confirms the risk-return tradeoff in mutual fund investments.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
